function show_versions_section(e){var s=[];e.generations.length>=1?($.each(e.generations,function(a,r){var i=r.id;s.push(['<li class="heading"><h4>',r.start_year," - ",r.end_year,"</h4></li>"].join("")),$.each(e.versions,function(e,a){i==a.generation_id&&s.push(['<li class="version" version_id="',a.id,'" id="version_',a.id,'"generation_id="',a.generation_id,'">','<a href="#">',a.name,"</a></li>"].join(""))})}),e.all_versions.length&&(s.push('<li class="heading"><h4>All Variants</h4></li>'),$.each(e.all_versions,function(e,a){s.push(['<li class="version" version_id="',a.id,'" id="version_',a.id,'"generation_id="">','<a href="#">',a.name,"</a></li>"].join(""))}))):e.versions.length>1&&(s.push('<li class="heading"><h4>All Variants</h4></li>'),$.each(e.versions,function(e,a){s.push(['<li class="version" version_id="',a.id,'" id="version_',a.id,'"generation_id="">','<a href="#">',a.name,"</a></li>"].join(""))})),0==e.versions.length&&0==e.all_versions.length&&s.push(['<li class="version" version_id="" generation_id="">','<a href="#">',"No Version Exist","</a></li>"].join("")),$(".version-listings").html(s.join("")),$(".version-listings .version").click(function(){handle_version_select(this)});var a=$("#used_car_car_version_id").val(),r=$("#used_car_car_model_generation_id").val();""!=a&&""!=r?handle_version_select("#version_"+a+'[generation_id="'+r+'"]'):""!=a?handle_version_select("#version_"+a):set_car_name()}function handle_version_loading(e,s){var a="/new-cars/grouped-versions";$(".version-listings").html(""),$(".version-listings-outer").addClass("loader"),$.ajax({url:a,type:"GET",data:{model_id:e,model_year:s},async:!0,success:function(e){$(".version-listings-outer").removeClass("loader"),show_versions_section(e)}})}function set_car_name(){$("#car_selector").val("");var e=$("#used_car_car_manufacturer_id").val(),s=$("#used_car_car_model_id").val(),a=$("#used_car_car_version_id").val(),r=$("#make_"+e).text();""!=e&&""!=s?($(".car-select-parent").addClass("input-success"),$(".car-select-parent").removeClass("input-failure"),r+=" "+$("#model_"+s).text()):($(".car-select-parent").removeClass("input-success"),$(".car-select-parent").addClass("input-failure")),""!=a&&""!=s&&(r+=" "+$("#version_"+a).text()),$("#car_selector").val(r)}function handle_year_change(){$("#used_car_car_manufacturer_id").val(""),$("#used_car_car_model_id").val(""),$("#used_car_car_version_id").val(""),handle_make_select(""),handle_model_select(""),$(this).val().length>0&&$("#car_selector_error").hide().html("")}function handle_make_select(e){$("#used_car_car_manufacturer_id").val(e),$("#used_car_car_manufacturer_id").trigger("change"),$("#used_car_car_model_id").val(""),$("#used_car_car_version_id").val(""),$(".version-listings").html(""),$(".model-listings.show").addClass("hide"),$(".model-listings.show").removeClass("show"),$(".models_for_"+e).removeClass("hide"),$(".models_for_"+e).addClass("show"),$(".make-listings .make.current").removeClass("current"),$(".model-listings .model.current").removeClass("current"),$("#make_"+e).addClass("current"),set_car_name(),$(".submit-button").attr("disabled","disabled"),$(".submit-button").removeClass("btn-primary")}function handle_model_select(e){$("#used_car_car_model_id").val(e),$("#used_car_car_model_id").trigger("change"),$("#used_car_car_version_id").val(""),$(".model-listings .model.current").removeClass("current"),$("#model_"+e).addClass("current"),e&&""!=$("#used_car_model_year").val()?(handle_version_loading(e,$("#used_car_model_year").val()),$(".submit-button").removeAttr("disabled"),$(".submit-button").addClass("btn-primary")):set_car_name()}function handle_version_select(e){var s=$(e).attr("version_id"),a=$(e).attr("generation_id");$("#used_car_car_version_id").val(s),$("#used_car_car_model_generation_id").val(a),$(".version-listings .version.current").removeClass("current"),$(e).addClass("current"),$("#get-car-name").modal("hide"),$("#used_car_car_version_id").trigger("change"),set_car_name()}$(function(){$(".make-listings .make").click(function(){if(allow_make_model_change){var e=$(this).data().make;handle_make_select(e),$(".cat-selection.active").removeClass("active"),$(".cat-selection.models").addClass("active")}}),$(".model-listings .model").click(function(){if(allow_make_model_change){var e=$(this).data().model;handle_model_select(e),$(".cat-selection.active").removeClass("active"),$(".cat-selection.versions").addClass("active")}}),$(".version-listings .version").click(function(){handle_version_select(this)}),$("#used_car_model_year").on("change",handle_year_change),$("#car_selector").focus(function(){$("#used_car_model_year").val().length>0?($("#car_selector_error").hide().html(""),$("#get-car-name").modal()):$("#car_selector_error").show().html("Please select the Model Year first")});var e=$("#used_car_car_manufacturer_id").val(),s=$("#used_car_car_model_id").val(),a=$("#used_car_car_version_id").val();handle_make_select(e),handle_model_select(s),$("#car_selector").parsley().destroy&&$("#car_selector").parsley().destroy(),$("#used_car_car_version_id").val(a),$("#get-car-name").on("shown",function(){var e=$(".make-listings .make.current").position();e&&$(".make-listings").scrollTop(e.top+$(".make-listings").scrollTop()-200);var s=$(".model-listings .model.current").position();s&&$(".model-listings.show").scrollTop(s.top+$(".model-listings.show").scrollTop()-200);var a=$(".version-listings .version.current").position();a&&$(".version-listings").scrollTop(a.top+$(".version-listings").scrollTop()-200)})});